<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/shadow.html">

<dom-module id="sketch-canvas">
  <template>
    <style>
      :host {
        @apply(--shadow-elevation-4dp);
        display: block;
        cursor: crosshair;
      }

      #sketchCanvas {
        width: 100%;
        height: 100%;
      }
    </style>
    <canvas id="sketchCanvas" on-track="_onTrack" width="800" height="600"></canvas>
  </template>
  <script>
    Polymer({
      is: 'sketch-canvas',

      ready: function() {
        this._canvas = this.$.sketchCanvas.getContext("2d");
        this._canvas.strokeStyle = "black";
        this._canvas.lineWidth = 3;
        this._canvas.lineJoin = "round";
        this._canvas.lineCap = "round";
        this._canvas.fillStyle = "white";
      },

      // Public properties

      properties: {
        disabled: {
          type: Boolean,
          value: false
        }
      },

      get data() {
        var data = [];

        for(var i in this._lines) {
          var line = new Array(this._lines[i].length);

          for(var j in this._lines[i]) {
            line[j] = this._pad(this._lines[i][j].toString(36), 2);
          }

          data.push(line.join(""));
        }

        return data.join(" ");
      },

      set data(data) {
        var lines = data.split(" ");
        this._lines = new Array(lines.length);

        for(var i in lines) {
          var line = new Array(lines[i].length / 2);

          for(var j = 0; j < lines[i].length; j += 2) {
            line[j / 2] = parseInt(lines[i].substr(j, 2), 36);
          }

          this._lines[i] = line;
        }

        this._render();
      },

      // Private properties

      _canvas: null,

      _lines: [],

      // Public methods

      play: function() {
        // TODO
      },

      stop: function() {
        // TODO
      },

      undo: function() {
        this._lines.pop();
        this._render();
      },

      // Private methods

      _onTrack(event) {
        // TODO
      },

      _render() {
        this._canvas.clearRect(0, 0, 800, 600);

        for(var i in this._lines) {
          this._canvas.beginPath();

          var x = this._lines[i][0];
          var y = this._lines[i][1];
          this._canvas.moveTo(x, y);

          for(var j = 2; j < this._lines[i].length; j += 2) {
            var x = this._lines[i][j];
            var y = this._lines[i][j + 1];
            this._canvas.lineTo(x, y);
          }

          this._canvas.stroke();
        }
      },

      _pad: function(n, width) {
        return Math.pow(10, Math.max(0, width - n.length)).toString().substr(1) + n;
      }
    });
  </script>
</dom-module>
