<link rel="import" href="../../bower_components/polymer/polymer.html">

<script>
  window.Sketch = window.Sketch || {};
  Sketch.HistoryBehavior = {
    properties: {
      _history: {
        type: Array,
        value: [],
        observer: '_updateHistory'
      },
      _head: {
        type: Number,
        value: 0,
        observer: '_updateHistory'
      },
      canUndo: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      },
      canRedo: {
        type: Boolean,
        value: false,
        notify: true,
        readOnly: true
      }
    },

    pushHistory: function(action) {
      this._history.length = this._head;
      this._history.push(action);
      this._head++;
      this._updateHistory();
    },

    clearHistory: function() {
      this._history = [];
      this._head = 0;
      this._updateHistory();
    },

    undo: function() {
      if(this._head > 0) {
        this._head--;
        this.fire('undo', this._history[this._head]);
        this._updateHistory();
      }
    },

    redo: function() {
      if(this._head < this._history.length) {
        this.fire('redo', this._history[this._head]);
        this._head++;
        this._updateHistory();
      }
    },

    _updateHistory: function() {
      this._setCanUndo(this._head > 0);
      this._setCanRedo(this._head < this._history.length);
    }
  };
</script>
